
-- Artist table
CREATE TABLE IF NOT EXISTS ARTIST(
    ID  BIGSERIAL NOT NULL PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    BIRTH DATE DEFAULT CURRENT_DATE,
    TOTAL_FOLLOWERS BIGINT DEFAULT 0,
    MONTHLY_LISTENERS BIGINT DEFAULT 0,
    ACTIVE BOOLEAN DEFAULT TRUE,
    NATIONALITY VARCHAR(10) DEFAULT 'US', -- ISO-3166-1 Alpha-2 2-Digit country code
    IMAGE_URL  TEXT DEFAULT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Artist(s) album table
/* ALBUM TYPE ENUM
*   Simple album    =   ALBUM
*   Single album    =   SINGLE
*/
CREATE TABLE IF NOT EXISTS ALBUM(
    ID BIGSERIAL NOT NULL PRIMARY KEY,
    TITLE TEXT NOT NULL,
    RELEASED_AT DATE DEFAULT CURRENT_DATE,
    TOTAL_SONGS INT DEFAULT 0,
    TOTAL_TIME INT DEFAULT 0, -- Milliseconds
    ALBUM_TYPE VARCHAR(100) DEFAULT 'ALBUM',
    IMAGE_URL TEXT DEFAULT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Relational table between album - artist (an album may have multiple artists)
CREATE TABLE IF NOT EXISTS ALBUM_ARTISTS(
    FK_ALBUM BIGINT NOT NULL REFERENCES ALBUM(ID) ON DELETE CASCADE,
    FK_ARTIST BIGINT NOT NULL REFERENCES ARTIST(ID)
);

-- Song table
CREATE TABLE IF NOT EXISTS SONG(
    ID BIGSERIAL NOT NULL PRIMARY KEY,
    TITLE TEXT NOT NULL,
    DURATION INT DEFAULT 0, -- Milliseconds
    RESOURCE_URL TEXT DEFAULT NULL,
    FK_ALBUM BIGINT NOT NULL REFERENCES ALBUM(ID) ON DELETE CASCADE,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);